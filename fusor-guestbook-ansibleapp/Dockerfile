FROM ansibleapp/ansibleapp-base
MAINTAINER Erik Nelson <ernelson@redhat.com>

LABEL "com.redhat.ansibleapp.version"="0.1.0"
LABEL "com.redhat.ansibleapp.spec"=\
"IyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMj\
IyMjCiMgTk9URTogVGhpcyBpcyBhIHByb3RvdHlwZSBiaW5kaW5nIGNvbnN1bWVyIGFuZCB3aWxs\
IGxpa2VseQojIGNoYW5nZSBmcmVxdWVudGx5IGFzIHRoZSBmb3JtYXQgaXMgaXRlcmF0ZWQgdXBv\
bgojIER5bmFtaWNhbGx5IGNvbnN1bWVzIEhPU1QvUE9SVCBmcm9tIGVudmlyb25tZW50IGJhc2Vk\
IG9uIGJpbmRpbmcKIyBrZXkuIEV4OiBiaW5kaW5nX2tleT1FWFRFUk5BTF9NTEFCLCBndWVzdGJv\
b2sgd2lsbCBsb29rIGZvcgojIEVYVEVSTkFMX01MQUJfU0VSVklDRV97SE9TVCxQT1JUfSBhcyBh\
cmUgcHJvdmlkZWQgYnkgdGhlIHNlcnZpY2UvZW5kcG9pbnQKIyBhc3NldHMgdGhhdCB3ZXJlIGNy\
ZWF0ZWQgYnkgYW4gZXh0ZXJuYWwtbWxhYi1hbnNpYmxlYXBwIHByb3Zpc2lvbi4KIwojIFNlY3Jl\
dHMgYXJlIG5vdCBhdmFpbGFibGUgeWV0LCBidXQgd2hlbiB0aGV5IGFyZSwgdGhleSB3aWxsCiMg\
YWxzbyBiZSBwcm92aWRlZCBieSBhIHBvZCBpbmplY3Rpb24gcG9saWN5LiBVbnRpbCBhIHJlYWwK\
IyBjYXRhbG9nIGNhbiBwcm92aWRlIHRoaXMgc2VydmljZSwgd2UnbGwgZmFrZSBpdCBhbmQgYWxs\
b3cgdGhlCiMgYXNiY2xpIHRvIHByb3ZpZGUgdGhlc2UgcGFyYW1ldGVycy4KIyMjIyMjIyMjIyMj\
IyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCmlkOiAzNWVh\
ZDRlOC1jZjFmLTQ5MDktYmIxYi1iOTgxZjRlYjMxNDIKbmFtZTogYW5zaWJsZWFwcC9mdXNvci1n\
dWVzdGJvb2stYW5zaWJsZWFwcApkZXNjcmlwdGlvbjogQSBtb25nbyBiYWNrZWQgZ3Vlc3Rib29r\
IGluIG5vZGUKYmluZGFibGU6IGZhbHNlCmFzeW5jOiAidW5zdXBwb3J0ZWQiCnBhcmFtZXRlcnM6\
CiAgLSBuYW1lOiBiaW5kaW5nX2tleQogICAgZGVzY3JpcHRpb246IGtleSB0byByZXNvbHZlIGJp\
bmQgcHJvcGVydGllcwogIC0gbmFtZTogbW9uZ29fdXNlcgogICAgZGVzY3JpcHRpb246IE1vbmdv\
REIgVXNlcgogICAgdHlwZTogc3RyaW5nCiAgLSBuYW1lOiBtb25nb19wYXNzCiAgICBkZXNjcmlw\
dGlvbjogTW9uZ29EQiBQYXNzd29yZAogICAgdHlwZTogc3RyaW5nCiAgLSBuYW1lOiBtb25nb19k\
YgogICAgZGVzY3JpcHRpb246IE1vbmdvREIgRGF0YWJhc2UKICAgIHR5cGU6IHN0cmluZwogIC0g\
bmFtZTogcHJvamVjdF9uYW1lCiAgICBkZXNjcmlwdGlvbjogT3BlbnNoaWZ0IHByb2plY3QKICAg\
IHR5cGU6IHN0cmluZwogICAgZGVmYXVsdDogZnVzb3ItZ3Vlc3Rib29rLWFuc2libGVhcHAK"
ADD ansible /opt/ansible
ADD ansibleapp /opt/ansibleapp

RUN useradd -u 1001 -r -g 0 -M -b /opt/ansibleapp -s /sbin/nologin -c "ansibleapp user" ansibleapp
RUN chown -R 1001:0 /opt/{ansible,ansibleapp}
USER 1001
