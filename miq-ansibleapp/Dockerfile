FROM ansibleapp/ansibleapp-base
# MAINTAINER {{ $MAINTAINER }}

LABEL "com.redhat.ansibleapp.version"="0.1.0"
LABEL "com.redhat.ansibleapp.spec"=\
"aWQ6IDcwZWJkOGEzLTI3ZDktNGFkYy1iM2QzLWMxYzQxYzU5MWU1NgpuYW1lOiBhbnNpYmxlYXBw\
L21pcS1hbnNpYmxlYXBwCmRlc2NyaXB0aW9uOiBNYW5hZ2VJUSBhbnNpYmxlYXBwIGltcGxlbWVu\
dGF0aW9uCmJpbmRhYmxlOiBmYWxzZQphc3luYzogb3B0aW9uYWwKcGFyYW1ldGVyczoKICAtIG5h\
bWU6IGFwcGxpY2F0aW9uX2luaXRfZGVsYXkKICAgIGRlc2NyaXB0aW9uOiBUaW1lIHRvIGRlbGF5\
IHdlYiBhcHAgc3RhcnR1cAogICAgdHlwZTogaW50CiAgICBkZWZhdWx0OiA2MAogIC0gbmFtZTog\
ZGF0YWJhc2VfcmVnaW9uCiAgICBkZXNjcmlwdGlvbjogTUlRIEluc3RhbmNlIFJlZ2lvbgogICAg\
dHlwZTogaW50CiAgICBkZWZhdWx0OiAxCiAgLSBuYW1lOiBkYXRhYmFzZV9zZXJ2aWNlX25hbWUK\
ICAgIGRlc2NyaXB0aW9uOiBTZXJ2aWNlIE5hbWUgZm9yIHRoZSBkYXRhYmFzZQogICAgdHlwZTog\
c3RyaW5nCiAgICBkZWZhdWx0OiBtaXEtcG9zdGdyZXNxbAogIC0gbmFtZTogbWVtY2FjaGVkX21h\
eF9jb25uZWN0aW9ucwogICAgZGVzY3JpcHRpb246IE1heGltdW0gbnVtYmVyIG9mIGNvbm5lY3Rp\
b25zIG1lbWNhY2hlZCB3aWxsIGFjY2VwdAogICAgdHlwZTogaW50CiAgICBkZWZhdWx0OiAxMDI0\
CiAgLSBuYW1lOiBtZW1jYWNoZWRfbWF4X21lbW9yeQogICAgZGVzY3JpcHRpb246IE1heGltdW0g\
bWVtb3J5IG1lbWNhY2hlZCB3aWxsIHVzZSBpbiBNQgogICAgdHlwZTogaW50CiAgICBkZWZhdWx0\
OiA2NAogIC0gbmFtZTogbWVtY2FjaGVkX3NsYWJfcGFnZV9zaXplCiAgICBkZXNjcmlwdGlvbjog\
TWVtY2FjaGVkIFNsYWIgU2l6ZSBpbiBieXRlcwogICAgdHlwZTogc3RyaW5nCiAgICBkZWZhdWx0\
OiAxTQogIC0gbmFtZTogbWVtY2FjaGVkX3NlcnZpY2VfbmFtZQogICAgZGVzY3JpcHRpb246IFNl\
cnZpY2UgbmFtZSBvZiB0aGUgbWVtY2FjaGVkIGluc3RhbmNlIHRvIHVzZQogICAgdHlwZTogc3Ry\
aW5nCiAgICBkZWZhdWx0OiBtaXEtbWVtY2FjaGVkCiAgLSBuYW1lOiBuYW1lc3BhY2UKICAgIGRl\
c2NyaXB0aW9uOiBOYW1lc3BhY2UgdG8gZGVwbG95IHRoZSBjbHVzdGVyIHRvCiAgICB0eXBlOiBz\
dHJpbmcKICAgIGRlZmF1bHQ6IG1pcS1hbnNpYmxlYXBwCiAgLSBuYW1lOiBwb3N0Z3Jlc3FsX2Rh\
dGFiYXNlCiAgICBkZXNjcmlwdGlvbjogcG9zdGdyZXNxbCBkYXRhYmFzZSBuYW1lCiAgICB0eXBl\
OiBzdHJpbmcKICAgIGRlZmF1bHQ6IHZtZGJfcHJvZHVjdGlvbgogIC0gbmFtZTogcG9zdGdyZXNx\
bF9wYXNzd29yZAogICAgZGVzY3JpcHRpb246IHBvc3RncmVzcWwgZGF0YWJhc2UgcGFzc3dvcmQK\
ICAgIHR5cGU6IHN0cmluZwogICAgZGVmYXVsdDogYWRtaW4KICAtIG5hbWU6IHBvc3RncmVzcWxf\
dXNlcgogICAgZGVzY3JpcHRpb246IHBvc3RncmVzcWwgZGF0YWJhc2UgdXNlcm5hbWUKICAgIHR5\
cGU6IHN0cmluZwogICAgZGVmYXVsdDogYWRtaW4K"
ADD ansible /opt/ansible
ADD ansibleapp /opt/ansibleapp

RUN yum -y install epel-release centos-release-openshift-origin \
 && yum -y install origin

RUN useradd -u 1001 -r -g 0 -M -b /opt/ansibleapp -s /sbin/nologin -c "ansibleapp user" ansibleapp
RUN chown -R 1001:0 /opt/{ansible,ansibleapp}
USER 1001
